<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"></meta>
    <meta name="description" content="Saasufy chat app"></meta>
    <meta name="keywords" content="Saasufy chat"></meta>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saasufy Chat</title>
    <link rel="icon" type="image/png" href="./favicon.ico">
    <link rel="stylesheet" href="./styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
    <script src="https://saasufy.com/node_modules/saasufy-components/socket.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/app-router.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/log-in-form.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/collection-browser.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/collection-adder.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/log-out.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/oauth-link.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/oauth-handler.js" type="module" defer></script>
  </head>
  <body>
    <div class="main-container">
      <socket-provider class="main-socket-container" url="wss://saasufy.com/sid8001/socketcluster/">
        <app-router class="product-container centered-column-container" default-page="/chat">

          <template slot="page" route-path="/log-in" auth-redirect="/chat" no-auth-redirect="/log-in/sas" hard-redirect></template>

          <template slot="page" route-path="/log-in/sas" auth-redirect="/chat" hard-redirect>
            <log-in-form
              hostname="sas.saasufy.com"
              port="443"
              network-symbol="sas"
              chain-module-name="sas_chain"
              secure="true"
            ></log-in-form>
            <p>
              <a href="#/log-in/clsk">Log in via CLSK instead.</a>
            </p>
            <oauth-link class="log-in-oauth-section" provider="github" client-id="dabb51f8af31a0bc53bf">
              <template slot="item">
                <a href="https://github.com/login/oauth/authorize?client_id={{oauth.clientId}}&state={{oauth.state}}">
                  Log in with GitHub
                </a>
              </template>
              <div slot="viewport"></div>
            </oauth-link>
          </template>

          <template slot="page" route-path="/log-in/clsk" auth-redirect="/chat" hard-redirect>
            <log-in-form
              hostname="capitalisk.com"
              port="443"
              network-symbol="clsk"
              chain-module-name="capitalisk_chain"
              secure="true"
            ></log-in-form>
            <p>
              <a href="#/log-in/sas">Log in via SAS instead.</a>
            </p>
            <oauth-link class="log-in-oauth-section" provider="github" client-id="dabb51f8af31a0bc53bf">
              <template slot="item">
                <a href="https://github.com/login/oauth/authorize?client_id={{oauth.clientId}}&state={{oauth.state}}">
                  Log in with GitHub
                </a>
              </template>
              <div slot="viewport"></div>
            </oauth-link>
          </template>

          <template slot="page" route-path="/oauth">
            <oauth-handler provider="github" success-location-hash="/chat"></oauth-handler>
          </template>

          <template slot="page" route-path="/chat" no-auth-redirect="/log-in/sas">
            <div class="chat-top-row">
              <h1>Saasufy Chat</h1>
              <log-out onclick="logOut()"><a href="javascript:void(0)">Log out</a></log-out>
            </div>

            <collection-browser
              class="chat-browser"
              collection-type="Chat"
              collection-fields="username,message,createdAt"
              collection-view="recentView"
              collection-page-size="50"
              collection-view-params=""
            >
              <template slot="item">
                <div class="chat-message-container">
                  <div class="chat-wallet-address">
                    <b class="{{socket.authToken.username === Chat.username ? 'wallet-address-self' : 'wallet-address-other'}}">{{Chat.username}}</b>
                  </div>
                  <div class="chat-message">{{Chat.message}}</div>
                  <div class="chat-created-at">{{date(Chat.createdAt)}}</div>
                </div>
              </template>
              <div slot="viewport" class="chat-viewport"></div>
              <div slot="loader" class="loading-spinner-container">
                <div class="spinning">&#8635;</div>
              </div>
            </collection-browser>

            <collection-adder
              class="chat-adder-form"
              collection-type="Chat"
              collection-fields="message:textarea"
              model-values="username={{socket.authToken.username}}"
              submit-button-label="Send"
            ></collection-adder>
          </template>

          <div slot="viewport" class="main-viewport"></div>

        </app-router>
      </socket-provider>
    </div>
  </body>
</html>
