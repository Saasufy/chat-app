<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"></meta>
    <meta name="description" content="Saasufy chat app"></meta>
    <meta name="keywords" content="Saasufy chat"></meta>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saasufy Chat</title>
    <link rel="icon" type="image/png" href="./favicon.ico">
    <link rel="stylesheet" href="./styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
    <script src="https://saasufy.com/node_modules/saasufy-components/socket.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/app-router.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/log-in-form.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/collection-browser.js" type="module" defer></script>
    <script src="https://saasufy.com/node_modules/saasufy-components/collection-adder.js" type="module" defer></script>
  </head>
  <body>
    <div class="main-container">
      <socket-provider class="main-socket-container" url="wss://saasufy.com/sid8001/socketcluster/">
        <app-router class="product-container centered-column-container" default-page="/chat">

          <template slot="page" route-path="/log-in" auth-redirect="/chat" hard-redirect>
            <log-in-form
              hostname="sas.saasufy.com"
              port="443"
              network-symbol="sas"
              chain-module-name="sas_chain"
              secure="true"
            ></log-in-form>
          </template>

          <template slot="page" route-path="/chat" no-auth-redirect="/log-in">
            <h1>Saasufy Chat</h1>

            <collection-browser
              class="chat-browser"
              collection-type="Chat"
              collection-fields="username,message,createdAt"
              collection-view="recentView"
              collection-page-size="50"
              collection-view-params=""
            >
              <template slot="item">
                <div class="chat-message-container">
                  <div class="chat-username">
                    <b class="{{socket.authToken.walletAddress === Chat.username ? 'username-self' : 'username-other'}}">{{Chat.username}}</b>
                  </div>
                  <div class="chat-message">{{Chat.message}}</div>
                  <div class="chat-created-at">{{date(Chat.createdAt)}}</div>
                </div>
              </template>
              <div slot="viewport" class="chat-viewport"></div>
            </collection-browser>

            <collection-adder
              class="chat-adder-form"
              collection-type="Chat"
              collection-fields="message:textarea"
              model-values="username={{socket.authToken.walletAddress}}"
              submit-button-label="Send"
            ></collection-adder>

          </template>

          <div slot="viewport" class="main-viewport"></div>

        </app-router>
      </socket-provider>
    </div>
  </body>
</html>
